; speed bar setting
(require 'sr-speedbar)
(global-set-key (kbd "s-s") 'sr-speedbar-toggle)

;; flymake configration
;(autoload 'flymake-find-file-hook "flymake" "" t)
;(add-hook 'find-file-hook 'flymake-find-file-hook)
;(setq flymake-gui-warnings-enabled nil)
;(setq flymake-log-level 0)

;; add the cedet function that need the 23.2 up version
;(require 'cedet)
;;;;  Helper tools for semantic
;(custom-set-variables
; '(semantic-default-submodes (quote (global-semantic-decoration-mode global-semantic-idle-completions-mode
;                                     global-semantic-idle-scheduler-mode global-semanticdb-minor-mode
;                                     global-semantic-idle-summary-mode global-semantic-mru-bookmark-mode)))
; '(semantic-idle-scheduler-idle-time 3))

;(semantic-mode)

;; Replace the M-x key for effective editing
;;(global-set-key "\C-x\C-m" 'execute-extended-command)

;;; uncomment this line to disable loading of "default.el" at startup
;;(setq inhibit-default-init t)
;; enable high lighting on selections
;(setq transient-mark-mode t)

;set the windmove-default-keybindings, so use the ALT + up or down to move the cursor to other-window 
(windmove-default-keybindings 'meta)

;;no startup message added by mlf
(setq inhibit-startup-message t)

;; disable the bell when error, added by mlf
(setq visible-bell t)

;;set this variable
;(auto-install-update-emacswiki-package-name t)
;If you want to use proxy server, For example: 
;(setq url-proxy-services '(("http" . "localhost:8339")))
;;useage
; M-x auto-install-from-emacswiki RET, input package name.
; After the AutoInstall download command is complete you can use the following commands:
;   1. Type "C-c C-c" to continue the install process.
;   2. Type "C-c C-d" view differences from the old version. This does nothing if you have no older version.
;   3. Type "C-c C-q" abort the install process.

;;disable toobar
(tool-bar-mode nil)
;;erase the scrool bar; no scroll bar, even in x-window system
(set-scroll-bar-mode nil)   

;; replace yes-or-no-p to y-or-n-p added by mlf
(fset 'yes-or-no-p 'y-or-n-p)

;; display time added by mlf
;;(display-time-mode 1)
(display-time)
;;use the 24hour format
(setq display-time-24hr-fromat t)
;; display time and date added by mlf
(setq display-time-day-and-date t)

;; set recursive operation
(setq dired-recursive-copies 'top)
(setq dired-recursive-deletes 'top)

;; enable recursive minibuffer by mlf
(setq enable-recursive-minibuffers t)


;; prevent the page jumped on scrolling, added by mlf
(setq scroll-step 1
      scroll-margin 3
      scroll-conservatively 1000)
;; accelerate file browse added by mlf
;(setq lazy-lock-defer-on-scrolling t)
;(setq font-lock-support-mode 'lazy-lock-mode)
;(setq font-lock-maximun-decoration t)

;; mouse auto void cursor function added by mlf
(mouse-avoidance-mode 'animate)
;;set mouse paste position
(setq mouse-yank-at-point t)
;;set mouse wheel mod
(mouse-wheel-mode t)


;; raise the kill-ring-max by mlf
(setq kill-ring-max 200)

;;display column-number added by mlf
(setq column-number-mode t)
(setq line-number-mode t)
;;(require 'linum)            
;;(global-linum-mode t)

;; set autosave directory and default version control set by mlf
(setq backup-directory-alist '(("." ."~/.emacs.d/.autosave")))
(setq version-control t)
(setq kept-new-versions 3)
(setq delete-old-versions t)
(setq kept-old-versions 2)
;; if don't want to backup file then remove the coloum below
;(setq make-backup-files nil)

;;set go language style and mode
(require 'go-mode-load)

;;set c++ style as stroustrup style 
(add-hook 'c++-mode-hook 
 '(lambda() 
  (c-set-style "stroustrup"))) 

;; the old javascript replaced by the espresso-mode below
;; Espresso-mode is a fork of Karl Landstrom  s mode below, 
;; but with additional features and robustness improvements
(autoload #'espresso-mode "espresso" "Start espresso-mode" t)
(add-to-list 'auto-mode-alist '("\\.js$" . espresso-mode))
(add-to-list 'auto-mode-alist '("\\.json$" . espresso-mode))
(add-to-list 'auto-mode-alist '("\\.jsm$" . espresso-mode))
(add-to-list 'auto-mode-alist '("\\.js\.in$" . espresso-mode))

;(autoload 'moz-minor-mode "moz" "Mozilla Minor and Inferior Mozilla Modes" t)
;(add-hook 'javascript-mode-hook 'javascript-custom-setup)
;(defun javascript-custom-setup ()
;         (moz-minor-mode 1))

(autoload 'moz-minor-mode "moz" "Mozilla Minor and Inferior Mozilla Modes" t)
    (add-hook 'espresso-mode-hook 'espresso-custom-setup)
    (defun espresso-custom-setup ()
      (moz-minor-mode 1))



;;set major mode to text-mode
(setq default-major-mode 'text-mode)

;; set tab function added by mlf
(setq-default indent-tabs-mode nil)
    (setq default-tab-width 4)
    (setq tab-stop-list ())
;;(loop for x downfrom 40 to 1 do
;;(setq tab-stop-list (cons (* x 4) tab-stop-list)))

;;set display parentheses not jump the position by mlf
(show-paren-mode t)
(setq show-paren-style 'parentheses)

;;set display the name of buffer by mlf
(setq frame-title-format "emacs@%b")

;; syntax highlighting
(cond ((fboundp 'global-font-lock-mode)
       ;; Load the font-lock package.
       (require 'font-lock)
       ;; Maximum colors
       (setq font-lock-maximum-decoration t)
       ;; Turn on font-lock in all modes that support it
       (global-font-lock-mode t)))


;; set browse kill ring
(require 'browse-kill-ring)
(global-set-key [(control c)(k)] 'browse-kill-ring)
(browse-kill-ring-default-keybindings)

;; set color-theme by mlf
(require 'color-theme)
;; select color theme added by mlf
;(color-theme-dark-blue2)
(color-theme-gnome2)

;;replace "C-x o" to "M-o" for the other-window key binding
;(global-set-key (kbd "<f9>") 'other-window)

(define-prefix-command 'ctl-w-map)
(global-set-key (kbd "C-w ") 'ctl-w-map)
(global-set-key (kbd "C-w C-w") 'other-window)


;; set rectangle mark  by mlf
(require 'rect-mark)


;;set session.el
(require 'session)
(add-hook 'after-init-hook' session-initialize)

;;requset ibuffer added by mlf
(require 'ibuffer)
(global-set-key (kbd "C-x C-b") 'ibuffer)

;;uniquify-buffer-names 
(require 'uniquify)
(setq uniquify-buffer-name-style 'forward)


;;set ido mode by mlf
(require 'ido)
(ido-mode t)

;;set tabbar utility by mlf
(require 'tabbar)
(tabbar-mode)
(global-set-key (kbd "M-[") 'tabbar-backward-group)
(global-set-key (kbd "M-]") 'tabbar-forward-group)

(global-set-key (kbd "M-,") 'tabbar-backward)
(global-set-key (kbd "M-.") 'tabbar-forward)


;;set switch buffer function by mlf
(require 'swbuff)
(global-set-key (kbd "C-,") 'swbuff-switch-to-previous-buffer)
(global-set-key (kbd "C-.") 'swbuff-switch-to-next-buffer)
;(global-set-key [M-<] 'swbuff-switch-to-previous-buffer)
;(global-set-key 'M-right 'swbuff-switch-to-next-buffer)
(setq swbuff-exclude-buffer-regexps
      '("^ " "\\*.*\\*"))

(setq swbuff-status-window-layout 'scroll)
(setq swbuff-clear-delay 1)
    (setq swbuff-separator "|")
    (setq swbuff-window-min-text-height 1)

;;matching paren function added by mlf
(global-set-key "%" 'match-paren)
(defun match-paren (arg)
    "Go to the matching paren if on a paren; otherwise insert %."
    (interactive "p")
    (cond ((looking-at "\\s\(") (forward-list 1) (backward-char 1))
        ((looking-at "\\s\)") (forward-char 1) (backward-list 1))
        (t (self-insert-command (or arg 1)))))

;;go the char like fx ; command in vi
(defun wy-go-to-char (n char)
   "Move forward to Nth occurence of CHAR.
   Typing `wy-go-to-char-key' again will move forwad to the next Nth
   occurence of CHAR."
     (interactive "p\ncGo to char: ")
     (search-forward (string char) nil nil n)
     (while (char-equal (read-char)
                             char)
        (search-forward (string char) nil nil n))
     (setq unread-command-events (list last-input-event)))

(define-key global-map (kbd "C-x g") 'wy-go-to-char)


;;set desktop by mlf
(load "desktop")
(desktop-save-mode 1)
;if desktop-save-mode defined 0 then uncomment two line below 
;(desktop-load-default)
;(desktop-read)


;;define a funciton to copy-one-line that was from internet
(defun copy-one-line (&optional n)
  "If region is active, copy region. Otherwise, copy line."
  (interactive "p")
  (if mark-active
      (kill-ring-save (region-beginning) (region-end))
    (if (> n 0)
        (kill-ring-save (line-beginning-position) (line-end-position n))
      (kill-ring-save (line-beginning-position n) (line-end-position)))))

(global-set-key (kbd "M-w") 'copy-one-line)

;;define a funciton to copy-one-word that was from internet
(defun copy-one-word()
  (interactive)
  (save-excursion
    (let ((end (progn (unless (looking-back "\\>" 1) (forward-word 1)) (point)))
          (beg (progn (forward-word -1) (point))))
      (copy-region-as-kill beg end)
      (message (substring-no-properties (current-kill 0))))))

(global-set-key (kbd "C-c w") 'copy-one-word)
;;bind the key to delete a (global-set-key "\C-w" 'backward-kill-word)
(global-set-key "\C-x\C-k" 'kill-region)
(global-set-key "\C-c\C-k" 'kill-region)

;;Unicad helps Emacs to guess the correct coding system when opening a file.
(require 'unicad)

;;settting for twitter
;;(require 'twit)
;;(setq twit-show-user-images t) ;;dislpay the head of friend
;;(setq twit-user-image-dir "~/.twit") ;; set the directory to save head image


(setq gnus-select-method '(nntp "news.cn99.com")
      gnus-secondary-select-methods
      '((nnml "")
        ;; (nntp "news.individual.net")
        ;;(nntp "news.gmane.org")
        (nntp "news.newsfan.net")
        (nntp "news.yaako.com"))) 

(setq gnus-default-subscribed-newsgroups
      '("gnu.emacs.help"     ;; emacs group
        "cn.comp.os.linux")) ;; a emacs little bang made of chinese

(add-to-list 'auto-mode-alist
             (cons (concat "\\." (regexp-opt '("xml" "xsd" "sch" "rng" "xslt" "svg" "rss" "xul" "rdf" "inc") t) "\\'")
                   'nxml-mode))

;(unify-8859-on-decoding-mode)

(setq magic-mode-alist
      (cons '("<  ?xml " . nxml-mode)
            magic-mode-alist))
(fset 'xml-mode 'nxml-mode)

;; use the dea utils
(require 'util)
;; Load the auto-complete settings
(add-to-list 'load-path "~/elisp/emacs/emcex/auto-complete")
(add-to-list 'load-path "~/elisp/emacs/emcex/yasnippet-0.6.1c")
(load-file "~/elisp/emacs/emcex/auto-complete-settings.el")
;(load-file "~/elisp/emacs/emcex/init-auto-complete.el")
(set-face-background 'ac-candidate-face "lightgray")
(set-face-underline 'ac-candidate-face "darkgray")
(set-face-background 'ac-selection-face "steelblue") ; set the color

;; use the file-search
(require 'file-search)

;; switch the .cpp and .h
;;;###autoload
(defun switch-source-file ()
  (interactive)
  (setq file-name (buffer-file-name))
  (if (string-match "\\.cpp" file-name)
      (find-file (replace-regexp-in-string "\\.cpp" "\.h" file-name)))
  (if (string-match "\\.cc" file-name)
      (find-file (replace-regexp-in-string "\\.cc" "\.h" file-name)))
  (if (string-match "\\.h" file-name)
      (find-file (replace-regexp-in-string "\\.h" "\.cpp" file-name))))

(global-set-key [f11] 'switch-source-file)

;; haskell mode configration
(load "~/elisp/emacs/emcex/haskell-mode-2.7.0/haskell-site-file")
;;{{{ Haskell Programming Style
;;Interaction with inferior Haskell interpreter: just hit C-c C-z  or  C-c C-l
;; document mode
(add-hook 'haskell-mode-hook 'turn-on-haskell-doc-mode)
;; auto indent and tab can provide some hints
(add-hook 'haskell-mode-hook 'turn-on-haskell-indent)
;; turn on highlighting
(add-hook 'haskell-mode-hook 'font-lock-mode)
;; add imenu
(add-hook 'haskell-mode-hook 'imenu-add-menubar-index)
;; turn on folding mode, must after install the folding mark on haskell mode
;; on folding.el 's marks-list add the line below  
;; (folding-add-to-marks-list 'haskell-mode    "-- {{{" "-- }}}" nil t)  
;;(add-hook 'haskell-mode-hook 'folding-mode)
;; outline-minor-mode function folding 
;; Emacs's outline mode doesn't support the haskell
(add-hook 'haskell-mode-hook 'outline-minor-mode)
;; therefor define a folding mark on here 
;; haskell support the embeded definination of function£¬therefor just do 
;; a simple solution
;; 
;; set the folding mark for the siginature of the outest function 
;;(defun my-haskell-mode-hook()
;;(make-local-variable 'outline-regexp)
;;(setq outline-regexp "^\\w+[^\n\r]*::[^\n\r]*"))
;;(add-hook 'haskell-mode-hook 'my-haskell-mode-hook)
;;}}} Haskell Style End


